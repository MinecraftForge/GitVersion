# Git Version Gradle 3

Git Version Gradle 3 the new release of the Git Version plugin now independent
of GradleUtils. It also includes a complete rewrite of the plugin, now uses
the Git Version jar as an executable (`ValueSource` for Git Version, `JavaExec`
for Changelog), and provides access to much more data regarding the containing
Git repository. This plugin is written for Java version 17 and targets Gradle
9.0.0.

## Additions

### Git Version

Git Version Gradle now delegates all actions to Git Version, which is a separate
tool that can be invoked from the command line. This was done to address the
need to calculate consistent version numbers from Git history while not being
restricted to Gradle's runtime. For example, in MinecraftForge projects, the
SharedActions configurations (currently on branch `v0`) will invoke Git Version
as a command to verify the version and send it to the Discord server in the
`#builds` channel.

> [!WARNING]
> Git Version Gradle does not currently have a way of comparing the project's
> version to one that could be given by a CI. This will be done in a future
> update when necessary.

### Proper API Isolation

Git Version Gradle exposes proper API interfaces as opposed to full-on Groovy
classes. The implementations of these classes implement Gradle's `HasPublicType`
interface, so they will be linted by IDEs correctly. The goal is to allow
implementations to change dynamically without accidentally adding or removing
public members.

> [!WARNING]
> There is a known issue with IntelliJ's Gradle Groovy DSL linter where plugins
> that are applied to `settings.gradle` do not have any linting in either that
> file or in the `build.gradle` if it is later applied in the project.

### Proper Errors and Warnings

Git Version Gradle now takes full advantage of Gradle's incubating Problems API
to report problems with as much detail as is available. IDEs are beginning to
adopt the Problems API, with the first one being Eclipse (disabled by default,
check settings).

Exceptions that are thrown with problems attached to them by Git Version will
have increased details in the error message on the console window, visible in
terminals and IDEs.

> [!WARNING]
> This feature is still experimental, and there may be some cases where an error
> is thrown that Git Version has not provided extra details on. Additionally,
> the Problems API is still incubating, and changes to it can be made at any
> time which can break Git Version in a minor update of Gradle 9.x.

## Changes

### Proper Configuration Caching

Git Version is now free of all configuration cache issues that had plagued it
in GradleUtils 2.x. This was done by changing how the plugin works at a
fundemental level. Instead of doing all the work within Gradle, a `ValueSource`
is now used to run a `JavaExec` action on the Git Version fatjar, which will
output the data in a JSON format that can be consumed by the plugin.

The Git Version fatjar is downloaded by Git Version Gradle using the tooling
system from GradleUtils Shared. Gradle is aware of this tool, and changes to it
will affect the cache (usually invalidation). Since Gradle does not use its file
watcher when executing programs, Git Version does not need to use hacks (i.e.
disabling the system configuration) in order to get the information it needs,
leading to much more consistent data.

### Plugin Application

Git Version Gradle is no longer restricted to only projects. It can now be
applied to the `settings.gradle(.kts)` as well. Settings that apply this plugin
will act identical to projects, but all projects contained within the build
will have their `version` values set to `gitversion.tagOffset`. Additionally,
if the root project applies the plugin, it will copy the extension from the one
created from `settings.gradle` instead of creating an entirely new object and
re-running GitVersion gradle. This makes versioning for subprojects much more
practical, efficient, and intentional.

## Removals

### Mutable Version Info

Git version info can no longer be mutated in the Gradle runtime. The source of
truth for how versions are calculated and what subprojects to consider will be
read from `.gitversion.toml` in the *root project's* folder. More documentation
on how to best utilize Git Version to advantage will come at a later date.
